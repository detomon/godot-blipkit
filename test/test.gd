extends Node2D

var _tracks: Array[BlipKitTrack] = []

@onready var _audio_stream_player: AudioStreamPlayer = %AudioStreamPlayer

var _parser := MidiFileParser.load_packed_byte_array(Marshalls.base64_to_raw("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"))


func _ready() -> void:
	_audio_stream_player.play()
	_init_track()


func _init_track() -> void:
	var playback: AudioStreamBlipKitPlayback = _audio_stream_player.get_stream_playback()

	for t in _parser.tracks:
		var track := BlipKitTrack.new()
		_tracks.append(track)

	for track in _parser.tracks:
		for midi in track.midi:
			prints(midi.status, midi.octave, midi.key, midi.delta_ticks)
			match midi.status:
				MidiFileParser.Midi.Status.NOTE_ON:
					pass
				MidiFileParser.Midi.Status.NOTE_OFF:
					pass
