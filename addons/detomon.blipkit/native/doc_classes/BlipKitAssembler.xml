<?xml version="1.0" encoding="UTF-8" ?>
<class name="BlipKitAssembler" inherits="RefCounted" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/godotengine/godot/master/doc/class.xsd">
	<brief_description>
		Generate byte code from instructions.
	</brief_description>
	<description>
		Generated byte code can be interpreted and executed with [BlipKitInterpreter].
		Named labels can be used to create function calls and loops.
		[b]Example:[/b] Generate instructions to play an iconic startup sound:
		[codeblocks]
		[gdscript]
		var assem := BlipKitAssembler.new()

		# Initialize track.
		assem.put(BlipKitAssembler.INSTR_WAVEFORM, BlipKitTrack.WAVEFORM_SQUARE)
		assem.put(BlipKitAssembler.INSTR_DUTY_CYCLE, 8)

		# Define a label "start" to loop back.
		assem.put_label("start")

		# Play notes.
		assem.put(BlipKitAssembler.INSTR_ATTACK, float(BlipKitTrack.NOTE_C_5))
		assem.put(BlipKitAssembler.INSTR_TICK, 18)
		assem.put(BlipKitAssembler.INSTR_ATTACK, float(BlipKitTrack.NOTE_C_6))
		assem.put(BlipKitAssembler.INSTR_VOLUME_SLIDE, 162)
		assem.put(BlipKitAssembler.INSTR_VOLUME, 0.0)
		assem.put(BlipKitAssembler.INSTR_TICK, 162)
		assem.put(BlipKitAssembler.INSTR_RELEASE)
		assem.put(BlipKitAssembler.INSTR_VOLUME_SLIDE, 0)
		assem.put(BlipKitAssembler.INSTR_VOLUME, 1.0)
		assem.put(BlipKitAssembler.INSTR_TICK, 180)

		# Jump back to label "start".
		assem.put(BlipKitAssembler.INSTR_JUMP, "start")

		# Compile byte code and check for errors.
		if assem.compile() != BlipKitAssembler.OK:
		    printerr(assem.get_error_message())
		    return

		# Get the byte code.
		var bytes := assem.get_byte_code()
		[/gdscript]
		[/codeblocks]
	</description>
	<tutorials>
	</tutorials>
	<methods>
		<method name="clear">
			<return type="void" />
			<description>
				Clears all instructions and errors.
			</description>
		</method>
		<method name="compile">
			<return type="int" enum="BlipKitAssembler.Error" />
			<description>
				Resolves label addresses and generated the byte code. Call [method get_byte_code] to get the byte code.
				Call [method clear] to generate new byte code.
			</description>
		</method>
		<method name="get_byte_code" qualifiers="const">
			<return type="PackedByteArray" />
			<description>
				Returns the generated byte code.
				Returns an empty array if [method compile] was not called yet or an error occurred.
			</description>
		</method>
		<method name="get_error_message" qualifiers="const">
			<return type="String" />
			<description>
				Returns the last error as string.
				Returns an empty string if no error occurred.
			</description>
		</method>
		<method name="put">
			<return type="int" enum="BlipKitAssembler.Error" />
			<param index="0" name="instruction" type="int" enum="BlipKitAssembler.Instruction" />
			<param index="1" name="arg_1" type="Variant" default="null" />
			<param index="2" name="arg_2" type="Variant" default="null" />
			<param index="3" name="arg_3" type="Variant" default="null" />
			<description>
				Adds an instruction and returns [constant OK] on success. See [enum Instruction] for the required arguments.
				Returns [constant ERR_INVALID_INSTRUCTION] if [param instruction] is not valid.
				Returns [constant ERR_INVALID_ARGUMENT] if the arguments are invalid for [param instruction].
			</description>
		</method>
		<method name="put_code">
			<return type="int" enum="BlipKitAssembler.Error" />
			<param index="0" name="code" type="String" />
			<description>
				Parses a string containing instructions.
				Returns [constant ERR_PARSER_ERROR] if a parser error occurred.
				[b]Note:[/b] This method is not implemented yet.
			</description>
		</method>
		<method name="put_label">
			<return type="int" enum="BlipKitAssembler.Error" />
			<param index="0" name="label" type="String" />
			<description>
				Adds a named label at the current position which can be referenced by [constant INSTR_CALL] and [constant INSTR_JUMP] instructions.
				Returns [constant ERR_DUPLICATE_LABEL] if a label with the same name is already defined.
			</description>
		</method>
	</methods>
	<constants>
		<constant name="INSTR_ATTACK" value="2" enum="Instruction">
			Sets [member BlipKitTrack.note]. Expects a [float] argument.
		</constant>
		<constant name="INSTR_RELEASE" value="3" enum="Instruction">
			Calls [method BlipKitTrack.release]. Expects no arguments.
		</constant>
		<constant name="INSTR_MUTE" value="4" enum="Instruction">
			Calls [method BlipKitTrack.mute]. Expects no arguments.
		</constant>
		<constant name="INSTR_WAVEFORM" value="5" enum="Instruction">
			Sets [member BlipKitTrack.waveform]. Expects [enum BlipKitTrack.Waveform] as [int] argument.
		</constant>
		<constant name="INSTR_CUSTOM_WAVEFORM" value="6" enum="Instruction">
			Sets [member BlipKitTrack.custom_waveform] from the given slot. Expects a slot index as [int] argument between [code]0[/code] and [code]255[/code].
			Which [BlipKitWaveform] is used is define with [member BlipKitInterpreter.set_waveform].
		</constant>
		<constant name="INSTR_DUTY_CYCLE" value="7" enum="Instruction">
			Sets [member BlipKitTrack.duty_cycle]. Expects an [int] argument between [code]0[/code] and [code]15[/code]
		</constant>
		<constant name="INSTR_EFFECT_DIVIDER" value="8" enum="Instruction">
			Sets [member BlipKitTrack.effect_divider]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_VOLUME" value="9" enum="Instruction">
			Sets [member BlipKitTrack.volume]. Expects a [float] argument between [code]0.0[/code] and [code]1.0[/code].
		</constant>
		<constant name="INSTR_VOLUME_SLIDE" value="10" enum="Instruction">
			Sets [member BlipKitTrack.volume_slide]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_MASTER_VOLUME" value="11" enum="Instruction">
			Sets [member BlipKitTrack.master_volume]. Expects a [float] argument between [code]0.0[/code] and [code]1.0[/code].
		</constant>
		<constant name="INSTR_PANNING" value="12" enum="Instruction">
			Sets [member BlipKitTrack.panning]. Expects a [float] argument between [code]-1.0[/code] and [code]+1.0[/code].
		</constant>
		<constant name="INSTR_PANNING_SLIDE" value="13" enum="Instruction">
			Sets [member BlipKitTrack.panning_slide]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_PITCH" value="14" enum="Instruction">
			Sets [member BlipKitTrack.pitch]. Expects a [float] argument.
		</constant>
		<constant name="INSTR_PHASE_WRAP" value="15" enum="Instruction">
			Sets [member BlipKitTrack.phase_wrap]. Expects an [int] argument.
		</constant>
		<constant name="INSTR_PORTAMENTO" value="16" enum="Instruction">
			Sets [member BlipKitTrack.portamento]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_VIBRATO" value="17" enum="Instruction">
			Calls [method BlipKitTrack.set_vibrato]. Expects [code]ticks[/code] ([int] between [code]0[/code] and [code]65536[/code]), [code]delta[/code] ([float]) and [code]slide_ticks[/code] ([int] between [code]0[/code] and [code]65536[/code]).
		</constant>
		<constant name="INSTR_TREMOLO" value="18" enum="Instruction">
			Calls [method BlipKitTrack.set_tremolo]. Expects [code]ticks[/code] ([int] between [code]0[/code] and [code]65536[/code]), [code]delta[/code] ([float]) and [code]slide_ticks[/code] ([int] between [code]0[/code] and [code]65536[/code]).
		</constant>
		<constant name="INSTR_ARPEGGIO" value="19" enum="Instruction">
			Sets [member BlipKitTrack.arpeggio]. Expects a [PackedFloat32Array] argument.
		</constant>
		<constant name="INSTR_ARPEGGIO_DIVIDER" value="20" enum="Instruction">
			Sets [member BlipKitTrack.arpeggio_divider]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_INSTRUMENT" value="21" enum="Instruction">
			Sets [member BlipKitTrack.instrument] from the given slot. Expects a slot index between [code]0[/code] and [code]255[/code] as [int] argument.
			Which [BlipKitInstrument] used is define with [member BlipKitInterpreter.set_instrument].
		</constant>
		<constant name="INSTR_INSTRUMENT_DIVIDER" value="22" enum="Instruction">
			Sets [member BlipKitTrack.instrument_divider]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_TICK" value="23" enum="Instruction">
			Interrupts the execution for a number of [i]ticks[/i]. Expects an [int] argument between [code]0[/code] and [code]65536[/code].
		</constant>
		<constant name="INSTR_CALL" value="24" enum="Instruction">
			Calls a named label like a function. Expects a label name as [String] argument.
			[b]Note:[/b] The label is not required to be defined at this point and can also be set later with [method put_label].
		</constant>
		<constant name="INSTR_RETURN" value="25" enum="Instruction">
			Returns from a function call made with [constant INSTR_CALL]. Expects no arguments.
		</constant>
		<constant name="INSTR_JUMP" value="26" enum="Instruction">
			Jumps to a named label. Expects the label name as [String] argument.
			[b]Note:[/b] The label is not required to be defined at this point and can also be set later with [method put_label].
		</constant>
		<constant name="INSTR_RESET" value="27" enum="Instruction">
			Calls [method BlipKitTrack.reset]. Expects no arguments.
		</constant>
		<constant name="INSTR_STORE" value="28" enum="Instruction">
			Stores a value in a register. Expects the register number as [int] argument between [code]0[/code] and [code]15[/code], and the value as [int] argument.
			The value can be read with [method BlipKitInterpreter.get_register].
		</constant>
		<constant name="OK" value="0" enum="Error">
			No error.
		</constant>
		<constant name="ERR_INVALID_STATE" value="1" enum="Error">
			The assembler is not in the correct state.
		</constant>
		<constant name="ERR_INVALID_INSTRUCTION" value="2" enum="Error">
			The instruction is invalid.
		</constant>
		<constant name="ERR_INVALID_ARGUMENT" value="3" enum="Error">
			An instruction argument is invalid.
		</constant>
		<constant name="ERR_DUPLICATE_LABEL" value="4" enum="Error">
			A named label already exists with the same name.
		</constant>
		<constant name="ERR_UNDEFINED_LABEL" value="5" enum="Error">
			A named label is not defined with the given name.
		</constant>
		<constant name="ERR_PARSER_ERROR" value="6" enum="Error">
		</constant>
	</constants>
</class>
